---
title: "What typifies Kizomba music?"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## GitHub Documents

Differences in Scale, Valence, Energy and Loudness in 2022 tophits lists of Pop, Bachata and Kizomba






## Differences in Scale, Valence, Energy and Loudness in 2022 tophits lists of Pop, Bachata and Kizomba

You can include R code in the document as follows:

```{r cars}


install.packages(devtools)
library(usethis)
library(devtools)
devtools::intstall_github('charlie86/spotifyr')
library(spotifyr)
library(tidyverse)
library(knitr)
library(tidyr)
Sys.setenv(SPOTIFY_CLIENT_ID = '9f3fa72cb3d948e496c93a9ea74ff94b')
Sys.setenv(SPOTIFY_CLIENT_SECRET = 'a7ecccc3b9d846f28d1636eacdbc94e2')

acces_token <- get_spotify_access_token()

kizombatophits <- get_playlist_audio_features("", "09gysnJpfQ3ublBmJDfcEC?si=5ea5c640ed424139")
library(knitr)
kizombatophits %>%
  count(key_mode, sort = TRUE) %>%
  head(20) %>% 
  kable()


library(ggjoy)
ggplot(kizombatophits, aes(x=valence, y=song_name))+
  geom_joy()+
  theme_joy()


library(ggjoy)



kizombaparty <- get_track_audio_features(c("09gysnJpfQ3ublBmJDfcEC?si=5ea5c640ed424139"))
originalparty <- get_track_audio_features(c("2pgDBO0ZAgvye7joSmdDm8?si=2552a28412744719"))
kizombatophits <- get_playlist_audio_features("", "0Pk8kSKJ5vO5yIA36kzGMu?si=799fc3e1c4df4215")

library(ggjoy)
ggplot(kizombatophits, aes(x=valence, y=track_name))+
  geom_joy()+
  theme_joy()

kizombatophits %>%
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  )

remotes::install_github('jaburgoyne/compmus')

kizombatophits <-
  get_tidy_audio_analysis("0e8nrvls4Qqv5Rfa2UhqmO") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)


kizombatophits %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

kizombatophits %>%
  arrange(-valence) %>%
  select(track_name, valence) %>%
  head(80) %>%
  kable()

kizombatophits <- get_playlist_audio_features("", "0Pk8kSKJ5vO5yIA36kzGMu?si=799fc3e1c4df4215")
bachatatophits <- get_playlist_audio_features("", "3mmU6TpfA93BD13wZEMQdP?si=35116dac512743e7")
poptophits <- get_playlist_audio_features("", "05nCXZLYE5sgzonkzdNaP4?si=5c2b8c4d7b1c43a2")

tophits <-
  bind_rows(
    kizombatophits %>% mutate(category = "Kizomba"),
    bachatatophits %>% mutate(category = "Bachata"),
    poptophits %>% mutate(category = "Pop")
  )
  
  tophits %>%
  ggplot(aes(x = energy)) +
  geom_histogram(binwidth = 0.1) +
  facet_wrap(~category)


tophits %>%                    # Start with awards.
  mutate(
    mode = ifelse(mode == 0, "Minor", "Major")
  ) %>%
  ggplot(                     # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = loudness,
      colour = mode
    )
  ) +
  geom_point() +              # Scatter plot.
  geom_rug(size = 0.1) +      # Add 'fringes' to show data distribution.
  geom_text(                  # Add text labels from above.
    aes(
      x = valence,
      y = energy,
      label = label
    ),
    data = 
      tibble(
        label = c("", "ENERGY"),
        category = c("Kizomba", "Pop"),
        valence = c(0.090, 0.123),
        energy = c(0.101, 0.967)
      ),
    colour = "black",         # Override colour (not mode here).
    size = 3,                 # Override size (not loudness here).
    hjust = "left",           # Align left side of label with the point.
    vjust = "bottom",         # Align bottom of label with the point.
    nudge_x = -0.05,          # Nudge the label slightly left.
    nudge_y = 0.02            # Nudge the label slightly up.
  ) +
  facet_wrap(~category) +     # Separate charts per playlist.
  scale_x_continuous(         # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),   # Use grid-lines for quadrants only.
    minor_breaks = NULL       # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(         # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_brewer(        # Use the Color Brewer to choose a palette.
    type = "qual",            # Qualitative set.
    palette = "Paired"        # Name of the palette is 'Paired'.
  ) +
  scale_size_continuous(      # Fine-tune the sizes of each point.
    trans = "exp",            # Use an exp transformation to emphasise loud.
    guide = "none"            # Remove the legend for size.
  ) +
  theme_light() +             # Use a simpler theme.
  labs(                       # Make the titles nice.
    x = "Valence",
    y = "Energy",
    colour = "Mode"
  )


```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


